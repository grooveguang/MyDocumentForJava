<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/10.0.10240 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="2531"/>

<div>
<span><div><span><font style="font-size: 14pt;">1、数据过多</font></span></div><div><span><font style="font-size: 14pt;">      分库分表</font></span></div><div><span><br/></span></div><div><span style="font-size: 19px; line-height: 27px;">2、关联了太多的表，太多join</span></div><div><span style="font-size: 19px; line-height: 27px;">      sql优化</span></div><div><br/></div><div><span style="font-size: 19px; line-height: 27px;">3、没有充分利用到索引</span></div><div><span style="font-size: 19px; line-height: 27px;">       索引建立</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(255, 0, 0); font-size: 12pt;">Mysql</span><span style="text-indent: 0mm; font-family: 宋体; color: rgb(255, 0, 0); font-size: 12pt;">一般情况下，查询一张表只会用到其中的一个索引，所以单值索引有时候并不能把</span><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(255, 0, 0); font-size: 12pt;">sql</span><span style="text-indent: 0mm; font-family: 宋体; color: rgb(255, 0, 0); font-size: 12pt;">的查询条件都纳入索引查找范围。所以需要适当的使用复合索引。</span></div></div><div><br/></div><div><span style="font-size: 19px; line-height: 27px;">4、服务器调优及各个参数设置</span></div><div><span style="font-size: 19px; line-height: 27px;">      调整my.cnf</span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="2533"/>

<div>
<span><div><span><font style="font-size: 18pt; color: rgb(209, 0, 255);">join图</font></span></div><div><span><font style="font-size: 14pt;"> <img src="05_mysql_02_索引优化分析_files/Image.png" type="image/png" data-filename="" style="font-size: 14pt;" width="1367"/></font></span></div><div><span><br/></span></div><div><span><font style="font-size: 14pt;"><br/></font></span></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(209, 0, 255);">建表SQL</font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">CREATE TABLE `t_dept` (</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> `id` INT(11) NOT NULL AUTO_INCREMENT,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> `deptName` VARCHAR(30) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> `address` VARCHAR(40) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> PRIMARY KEY (`id`)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"><br/></font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">CREATE TABLE `t_emp` (</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> `id` INT(11) NOT NULL AUTO_INCREMENT,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> `name` VARCHAR(20) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">  `age` INT(3) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> `deptId` INT(11) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">empno int  not null,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> PRIMARY KEY (`id`),</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> KEY `idx_dept_id` (`deptId`)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> #CONSTRAINT `fk_dept_id` FOREIGN KEY (`deptId`) REFERENCES `t_dept` (`id`)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_dept(deptName,address) VALUES('华山','华山');</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_dept(deptName,address) VALUES('丐帮','洛阳');</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_dept(deptName,address) VALUES('峨眉','峨眉山');</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_dept(deptName,address) VALUES('武当','武当山');</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_dept(deptName,address) VALUES('明教','光明顶');</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">INSERT INTO t_dept(deptName,address) VALUES('少林','少林寺');</span></font><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('风清扬',90,1,100001);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('岳不群',50,1,100002);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('令狐冲',24,1,100003);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="font-size: 12pt; text-indent: 0mm; line-height: 1.45; font-family: 'Lucida Grande';">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('洪七公',70,2,100004);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('乔峰',35,2,100005);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('灭绝师太',70,3,100006);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('周芷若',20,3,100007);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('张三丰',100,4,100008);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('张无忌',25,5,100009);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">INSERT INTO t_emp(NAME,age,deptId,empno) VALUES('韦小宝',18,null,100010);</font></span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 18pt; color: rgb(209, 0, 255);">7种join</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">1   所有有门派的人员信息</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">（ A、B两</span><span style="text-indent: 0mm; min-height: 8pt; font-family: Arial; color: rgb(51, 51, 51);">表共有</span><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">）</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"> select * from t_emp a</span> <span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">inner join</span> <span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">t_dept b on a.deptId = b.id;</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">2   列出所有用户，并显示其机构信息</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> （A的全集）</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"> select * from t_emp a</span> <span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">left join</span> <span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">t_dept b on a.deptId = b.id;</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">3   列出所有门派</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">（B的全集）</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> select * from  t_dept  b </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">4   所有不入门派的人员</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">（A</span><span style="text-indent: 0mm; min-height: 8pt; font-family: Arial; color: rgb(51, 51, 51);">的独有</span><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">）</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">select * from t_emp a left join t_dept b on a.deptId = b.id where b.id is null;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">5   所有没人入的门派</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">（B的独有）</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> select * from t_dept b left join  t_emp a on a.deptId = b.id where a.deptId is null; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">6  列出所有人员和机构的对照关系</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">(AB全有)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">#MySQL Full Join的实现 因为MySQL不支持FULL JOIN,下面是替代方</span><span style="text-indent: 0mm; font-family: Arial; color: rgb(51, 51, 51);">法</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> #left join + union(可去除重复数据)+ right join</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">SELECT * FROM t_emp A LEFT JOIN t_dept B ON A.deptId = B.id</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">UNION</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">SELECT * FROM t_emp A RIGHT JOIN t_dept B ON A.deptId = B.id</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">7 列出所有没入派的人员和没人入的门派</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">（A的独有+B的独有）</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">SELECT * FROM t_emp A LEFT JOIN t_dept B ON A.deptId = B.id WHERE B.`id` IS NULL</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">UNION</font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">SELECT * FROM t_emp A RIGHT JOIN t_dept B ON A.deptId = B.id WHERE A.`deptId` IS NULL;</font></span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(209, 0, 255);">增加掌门字段</font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">ALTER TABLE `t_dept`</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">add</span><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span> <span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">CEO  INT(11)  ;</span></font><span style="font-size: 12pt; font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">update t_dept set CEO=2 where id=1;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">update t_dept set CEO=4 where id=2;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">update t_dept set CEO=6 where id=3;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">update t_dept set CEO=8 where id=4;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">update t_dept set CEO=9 where id=5;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45; text-indent: 0mm;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">求各个门派对应的掌门人名称:</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 微软雅黑; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">select   * from t_dept as  b left  join t_emp as a on  b.CEO=a.id;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">求所有当上掌门人的平均年龄:</font></span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45; text-indent: 0mm;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 微软雅黑; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">select  avg(a.age) from t_emp a inner join t_dept b on a.id=b.CEO  ;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 7pt;"><span style="text-indent: 0mm; min-height: 7pt; font-family: 微软雅黑; color: rgb(255, 0, 0);"><font style="font-size: 12pt;">求所有人物对应的掌门名称:</font></span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="2537"/>

<div>
<span><div><font><font style="font-size: 18pt; color: rgb(209, 0, 255);">索引是什么</font><br/></font></div><div><font><span style="font-size: 14pt;">      </span><font style="font-size: 14pt;"><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51);">MySQL</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">官方对索引的定义为：索引（</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51);">Index</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">）是帮助</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51);">MySQL</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">高效获取数据的数据结构。</span></font></font></div><div><font style="font-size: 14pt;"><span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51);">可以得到索引的本质：索引是数据结构。</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 12pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">       </span><span style="text-indent: 0mm; min-height: 12pt; font-family: 'Lucida Grande';">索引的目的在于提高查询效率，可以类比字典，</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; line-height: 1.45;">如果要查“mysql”这个单词，我们肯定需要定位到m字母，然后从下往下找到y字母，再找到剩下的sql。</span></font></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">        </span><span style="font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;">如果没有索引，那么你可能需要a----z，如果我想找到Java开头的单词呢？或者Oracle开头的单词呢？</span></font></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">        </span><span style="font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;">是不是觉得如果没有索引，这个事情根本无法完成？</span></font></div></div><div><span style="min-height: 15pt; font-family: 宋体; color: rgb(255, 0, 0); font-size: 12pt; font-weight: bold;"><br/></span></div><div><span style="min-height: 15pt; font-family: 宋体; color: rgb(255, 0, 0); font-size: 12pt; font-weight: bold;">你可以简单理解为“排好序的快速查找数据结构”。</span></div><div><font style="font-size: 14pt;">    详解：</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; font-weight: bold; color: rgb(51, 51, 51);"> </span><font style="font-size: 12pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-weight: bold; color: rgb(51, 51, 51);">在数据之外，</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-weight: bold;">数据库系统还维护着满足特定查找算法的数据结构</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-weight: bold; color: rgb(51, 51, 51);">，这些数据结构以某种方式引用（指向）数据，</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-weight: bold; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">这样就可以在这些数据结构上实现高级查找算法。这种数据结构，就是索引。下图就是一种可能的索引方式示例：</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 201pt;"><font style="font-size: 12pt;"><img src="05_mysql_02_索引优化分析_files/Image [1].png" type="image/png" data-filename="" style="font-family: Monaco; color: rgb(51, 51, 51);" width="591"/></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-weight: bold; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">左边是数据表，一共有两列七条记录，最左边的是数据记录的物理地址</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-weight: bold; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> 为了加快Col2的查找，可以维护一个右边所示的二叉查找树，每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找在一定的复杂度内获取到相应数据，从而快速的检索出符合条件的记录。</font></span></div></div><div><font style="font-size: 14pt;">    结论：</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 21pt; font-family: 宋体; color: rgb(0, 0, 255); font-size: 16pt; font-weight: bold;">   </span> <span style="min-height: 21pt; font-family: 宋体; color: rgb(0, 0, 255); font-weight: bold;"><font style="font-size: 12pt;">数据本身之外，数据库还维护着一个满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，这样就可以在这些数据结构的基础上实现高级查找算法，这种数据结构就是索引。</font></span></div></div><div><span style="min-height: 15pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储的磁盘上</font></span></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(209, 0, 255);">优势：</font></span></div><div><span style="font-size: 19px; line-height: 27px;"> </span> <span style="line-height: 27px;"><font style="font-size: 14pt;">  <span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">类似大学图书馆建书目索引，提高数据</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(255, 0, 0);">检索</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">的效率，降低数据库的</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51);">IO</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">成本</span></font></span></div><div><span style="line-height: 27px;"><font style="font-size: 14pt;">    <span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">通过索引列对数据进行</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(255, 0, 0);">排序</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">，降低数据排序的成本，降低了</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51);">CPU</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">的消耗</span></font></span></div><div><span style="font-size: 19px; line-height: 27px;"><br/></span></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(209, 0, 255);">劣势：</font></span></div><div><span style="font-size: 19px; line-height: 27px;">   </span> <span style="line-height: 27px;"><font style="font-size: 14pt;">  <span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51);">虽然索引大大提高了查询速度，同时却会</span><span style="min-height: 15pt; font-family: 宋体; color: rgb(255, 0, 0);">降低更新表的速度</span><span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51);">，如对表进行</span><span style="min-height: 15pt; font-family: Tahoma; color: rgb(51, 51, 51);">INSERT</span><span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51);">、</span><span style="min-height: 15pt; font-family: Tahoma; color: rgb(51, 51, 51);">UPDATE</span><span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51);">和</span><span style="min-height: 15pt; font-family: Tahoma; color: rgb(51, 51, 51);">DELETE</span><span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51);">。</span></font></span><font style="font-size: 14pt;"><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">因为更新表时，</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51);">MySQL</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51);">不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，</span></font><span style="color: rgb(51, 51, 51); font-family: 宋体; font-size: 14pt; line-height: 1.45;">都会调整因为更新所带来的键值变化后的索引信息</span></div><div><span style="font-size: 19px; line-height: 27px;">      <span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 12pt;">实际上索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录，所以索引列也是要</span><span style="min-height: 15pt; font-family: 宋体; color: rgb(255, 0, 0); font-size: 12pt;">占用空间</span><span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 12pt;">的</span></span></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div></span>
</div>
<hr>
<a name="2541"/>

<div>
<span><div><font><font style="font-size: 18pt; color: rgb(229, 0, 255);">BTree索引</font><br/></font></div><div><font style="font-size: 14pt;">   原理图</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 271pt;"><img src="05_mysql_02_索引优化分析_files/Image [2].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="780"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 4pt;"><span style="text-indent: 0mm; min-height: 4pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">【初始化介绍】</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">一颗b树，浅蓝色的块我们称之为一个磁盘块，可以看到每个磁盘块包含几个数据项（深蓝色所示）和指针（黄色所示），</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">如磁盘块1包含数据项17和35，包含指针P1、P2、P3，</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">P1表示小于17的磁盘块，P2表示在17和35之间的磁盘块，P3表示大于35的磁盘块。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 14pt; font-weight: bold; font-style: italic;">真实的数据存在于叶子节点</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">即3、5、9、10、13、15、28、29、36、60、75、79、90、99。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 14pt;">非叶子节点只不存储真实的数据，只存储指引搜索方向的数据项</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">，如17、35并不真实存在于数据表中。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 4pt;"><span style="text-indent: 0mm; min-height: 4pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">【查找过程】</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">如果要查找数据项29，那么首先会把磁盘块1由磁盘加载到内存，此时发生一次IO，在内存中用二分查找确定29在17和35之间，锁定磁盘块1的P2指针，内存时间因为非常短（相比磁盘的IO）可以忽略不计，通过磁盘块1的P2指针的磁盘地址把磁盘块3由磁盘加载到内存，发生第二次IO，29在26和30之间，锁定磁盘块3的P2指针，通过指针加载磁盘块8到内存，发生第三次IO，同时内存中做二分查找找到29，结束查询，总计三次IO。</span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">真实的情况是，3层的b+树可以表示上百万的数据，如果上百万的数据查找只需要三次IO，性能提高将是巨大的，如果没有索引，每个数据项都要发生一次IO，那么总共需要百万次的IO，显然成本非常非常高。</span></div></div><div><font style="font-size: 14pt;">  关于时间复杂度<br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">      </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">同一问题可用不同算法解决，而一个算法的质量优劣将影响到算法乃至程序的效率。算法分析的目的在于选择合适算法和改进算法。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 157pt;"><img src="05_mysql_02_索引优化分析_files/Image [3].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="637"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 297pt;"><img src="05_mysql_02_索引优化分析_files/Image [4].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="558"/></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 18pt; color: rgb(229, 0, 255);">B+Tree索引</font></div><div><font style="font-size: 14pt;">   原理图：</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><img src="05_mysql_02_索引优化分析_files/Image [5].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div><font style="font-size: 14pt;">  B树和B+树的区别</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">B+Tree与B-Tree 的区别</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">　1）B-树的关键字和记录是放在一起的，叶子节点可以看作外部节点，不包含任何信息；B+树的非叶子节点中只有关键字和指向下一个节点的索引，记录只放在叶子节点中。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">　 2）在B-树中，越靠近根节点的记录查找时间越快，只要找到关键字即可确定记录的存在；而B+树中每个记录的查找时间基本是一样的，都需要从根节点走到叶子节点，而且在叶子节点中还要再比较关键字。从这个角度看B-树的性能好像要比B+树好，而在实际应用中却是B+树的性能要好些。因为B+树的非叶子节点不存放实际的数据，这样每个节点可容纳的元素个数比B-树多，树高比B-树小，这样带来的好处是减少磁盘访问次数。尽管B+树找到一个记录所需的比较次数要比B-树多，但是一次磁盘访问的时间相当于成百上千次内存比较的时间，因此实际中B+树的性能可能还会好些，而且B+树的叶子节点使用指针连接在一起，方便顺序遍历（例如查看一个目录下的所有文件，一个表中的所有记录等），这也是很多数据库和文件系统使用B+树的缘故。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">思考：为什么说B+树比B-树更适合实际应用中操作系统的文件索引和数据库索引？</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">1) B+树的磁盘读写代价更低</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">　　B+树的内部结点并没有指向关键字具体信息的指针。因此其内部结点相对B 树更小。如果把所有同一内部结点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多。一次性读入内存中的需要查找的关键字也就越多。相对来说IO读写次数也就降低了。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">2) B+树的查询效率更加稳定</span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">　　由于非终结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。</span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(229, 0, 255);">聚簇索引与非聚簇索引</font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">术语‘聚簇’表示数据行和相邻的键值进错的存储在一起。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> 如下图，左侧的索引就是聚簇索引，因为数据行在磁盘的排列和索引排序保持一致。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 273pt;"><img src="05_mysql_02_索引优化分析_files/Image [6].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="539"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 1pt;"><span style="text-indent: 0mm; min-height: 1pt; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold; color: rgb(51, 51, 51);">聚簇索引的好处：</span></div><ul style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: disc;"><li style="margin-left: 26pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-size: 10pt; color: #010101;"><span style="font-family: Lucida Grande; font-size: 12pt; color: #000000; font-decoration: Normal;">按照聚簇索引排列顺序，查询显示一定范围数据的时候，由于数据都是紧密相连，数据库不不用从多个数据块中提取数据，所以节省了大量的io操作。</span></li></ul><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold; color: rgb(51, 51, 51);">聚簇索引的限制：</span></div><ul style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: disc;"><li style="margin-left: 26pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-size: 10pt; font-weight: Bold;"><span style="font-family: Lucida Grande; font-size: 12pt; color: #000000; font-decoration: Normal;">对于mysql数据库目前只有innodb数据引擎支持聚簇索引，而Myisam并不支持聚簇索引。</span></li><li style="margin-left: 26pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-size: 10pt; color: #010101;"><span style="font-family: Lucida Grande; font-size: 12pt; color: #000000; font-decoration: Normal;">由于数据物理存储排序方式只能有一种，所以每个Mysql的表只能有一个聚簇索引。一般情况下就是该表的主键。</span></li><li style="margin-left: 26pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-size: 10pt; color: #010101;"><span style="font-family: Lucida Grande; font-size: 12pt; color: #000000; font-decoration: Normal; font-weight: bold;">为了充分利用聚簇索引的聚簇的特性，所以innodb表的主键列尽量选用有序的顺序id，而不建议用无序的id，比如uuid这种。</span></li></ul></div><div><font style="font-size: 14pt;">​<br/></font></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(229, 0, 255);">full-text全文索引</font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">全文索引（也称全文检索）是目前搜索引擎使用的一种关键技术。它能够利用【分词技术】等多种算法智能分析出文本文字中关键词的频率和重要性，然后按照一定的算法规则智能地筛选出我们想要的搜索结果。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">CREATE TABLE `article` (</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">  `title` varchar(200) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">  `content` text,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">  PRIMARY KEY (`id`),</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);"><font style="font-size: 12pt;">  FULLTEXT KEY `title` (`title`,`content`)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">) ENGINE=MyISAM DEFAULT CHARSET=utf8;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">不同于like方式的的查询：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">SELECT * FROM article WHERE content LIKE ‘%查询字符串%’;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">全文索引用match+against方式查询：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">SELECT * FROM article WHERE MATCH(title,content) AGAINST (‘查询字符串’);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 4pt;"><span style="text-indent: 0mm; min-height: 4pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">明显的提高查询效率。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 4pt;"><span style="text-indent: 0mm; min-height: 4pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">限制：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">mysql5.6.4以前只有Myisam支持，5.6.4版本以后innodb才支持，但是官方版本不支持中文分词，需要第三方分词插件。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">5.7以后官方支持中文分词。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">随着大数据时代的到来，关系型数据库应对全文索引的需求已力不从心，逐渐被 solr,elasticSearch等专门的搜索引擎所替代。</span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><br/></div></span>
</div>
<hr>
<a name="2543"/>

<div>
<span><div><font><font style="font-size: 18pt; color: rgb(186, 0, 255);">单值索引</font><br/></font></div><div><font><span style="font-size: 14pt;">      </span><span style="min-height: 15pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">即一个索引只包含单个列，一个表可以有多个单列索引</font></span></font></div><div><font style="font-size: 14pt;">     语法：<br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 2pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">随表一起建索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE TABLE customer (id INT(10) UNSIGNED  AUTO_INCREMENT ,customer_no VARCHAR(200),customer_name VARCHAR(200),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">  PRIMARY KEY(id),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(255, 0, 0); font-size: 12pt;">  KEY (customer_name)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;"> </span><span style="font-family: Tahoma; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">单独建单值索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE  INDEX idx_customer_name ON customer(customer_name);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt;">删除</span><span style="text-indent: 0mm; min-height: 3pt; font-family: Tahoma; font-size: 12pt;">索引：</span></div><div><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">DROP INDEX idx_customer_name  on customer;</span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">唯一索引</font></span></div><div><span style="line-height: 27px;"><span style="font-size: 19px;">       </span><span style="min-height: 15pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">索引列的值必须唯一，但允许有空值</font></span></span></div><div><font style="font-size: 14pt;">       语法：</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 2pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">随表一起建索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE TABLE customer (id INT(10) UNSIGNED  AUTO_INCREMENT ,customer_no VARCHAR(200),customer_name VARCHAR(200),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">  PRIMARY KEY(id),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; font-size: 12pt; color: rgb(51, 51, 51);">  KEY (customer_name),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(255, 0, 0); font-size: 12pt;">  UNIQUE (customer_no)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;"> </span><span style="font-family: Tahoma; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">单独建唯一索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE UNIQUE</span> <span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">INDEX id</span><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; font-size: 12pt; color: rgb(51, 51, 51);">x_customer_no ON customer(customer_no);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt;">删除</span><span style="text-indent: 0mm; min-height: 3pt; font-family: Tahoma; font-size: 12pt;">索引：</span></div><div><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">DROP INDEX idx_customer_no on customer ;</span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">主键索引</font></span></div><div><span style="line-height: 27px;"><span style="font-size: 19px;">     </span><font style="font-size: 14pt;"> <span style="min-height: 17pt; color: rgb(51, 51, 51);">设定为主键后数据库会自动建立索引，</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">innodb</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">为聚簇索引</span></font></span></div><div><font style="font-size: 14pt;">      语法：</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 2pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">随表一起建索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE TABLE customer (id INT(10) UNSIGNED  AUTO_INCREMENT ,customer_no VARCHAR(200),customer_name VARCHAR(200),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(255, 0, 0); font-size: 12pt;">  PRIMARY KEY(id)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">);</span><span style="font-family: Tahoma; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">  </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE TABLE customer2 (id INT(10) UNSIGNED   ,customer_no VARCHAR(200),customer_name VARCHAR(200),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(255, 0, 0); font-size: 12pt;">  PRIMARY KEY(id)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: Tahoma; font-size: 12pt; text-indent: 0mm; line-height: 1.45;"> 单独建主键索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 微软雅黑; color: rgb(255, 0, 0); font-size: 12pt;">ALTER TABLE customer</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 微软雅黑; color: rgb(255, 0, 0); font-size: 12pt;"> add PRIMARY KEY customer(customer_no); </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 微软雅黑; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 微软雅黑; font-size: 12pt;">删除</span><span style="text-indent: 0mm; min-height: 3pt; font-family: Tahoma; font-size: 12pt;">建主键索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 微软雅黑; font-size: 12pt; color: rgb(51, 51, 51);">ALTER TABLE customer</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 微软雅黑; font-size: 12pt; color: rgb(51, 51, 51);"> drop PRIMARY KEY ; </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 微软雅黑; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 微软雅黑; font-size: 12pt;">修改</span><span style="text-indent: 0mm; min-height: 3pt; font-family: Tahoma; font-size: 12pt;">建主键索引：</span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">必须先删除掉(drop)原索引，再新建(add)索引</span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">​复合索引</font><br/></span></font></div><div><font size="1"><span style="line-height: 27px; font-size: 14pt;">     即一个索引包含多个列</span></font></div><div><span style="font-size: 19px; line-height: 27px;">     语法：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 2pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">随表一起建索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE TABLE customer (id INT(10) UNSIGNED  AUTO_INCREMENT ,customer_no VARCHAR(200),customer_name VARCHAR(200),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">  PRIMARY KEY(id),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; font-size: 12pt; color: rgb(51, 51, 51);">  KEY (customer_name),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; font-size: 12pt; color: rgb(51, 51, 51);">  UNIQUE (customer_name),</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(255, 0, 0); font-size: 12pt;">  KEY (customer_no,customer_name)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;"> </span><span style="font-family: Tahoma; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">单独建索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE </span> <span style="text-indent: 0mm; min-height: 0pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">INDEX idx_no_name ON customer(customer_no,customer_name);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt;">删除</span><span style="text-indent: 0mm; min-height: 3pt; font-family: Tahoma; font-size: 12pt;">索引：</span></div><div><span style="text-indent: 0mm; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">DROP INDEX idx_no_name  on customer ;</span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">基本语法</font></span></div><div><span style="font-size: 19px; line-height: 27px;">     创建  </span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 14pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">CREATE  [UNIQUE ]  INDEX [indexName] ON table_name(column))</span></div></div><div><span style="font-size: 19px; line-height: 27px;">     删除</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 14pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">DROP INDEX [indexName] ON mytable;</span></div></div><div><span style="font-size: 19px; line-height: 27px;">     查看</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 14pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">SHOW INDEX FROM table_name \G;</span></div></div><div><font style="font-size: 14pt;">     使用ALTER命令</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 12pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">有四种方式来添加数据表的索引：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">ALTER TABLE tbl_name ADD PRIMARY KEY (column_list): 该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">ALTER TABLE tbl_name ADD UNIQUE index_name (column_list): 这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">ALTER TABLE tbl_name ADD INDEX index_name (column_list): 添加普通索引，索引值可出现多次。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):该语句指定了索引为 FULLTEXT ，用于全文索引</span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div></span>
</div>
<hr>
<a name="2545"/>

<div>
<span><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">哪些情况需要创建索引</font></div><div><font style="font-size: 14pt;">1、主键自动建立唯一索引</font></div><div><font style="font-size: 14pt;">2、频繁作为查询条件的字段创建索引</font></div><div><font style="font-size: 14pt;">3、查询中与其它关联的字段，外键关系建立索引<br/></font></div><div><font style="font-size: 14pt;">4、<span style="min-height: 17pt; color: rgb(51, 51, 51);">单键</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">/</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">组合索引的选择问题，</span> <span style="min-height: 17pt; color: rgb(51, 51, 51);">组合索引性价比更高</span></font></div><div><font style="font-size: 14pt;"><font>5、<span style="min-height: 15pt; color: rgb(51, 51, 51);">查询中排序的字段，排序字段若通过索引去访问将大大提高排序</span></font><span style="min-height: 15pt; font-family: 宋体; color: rgb(51, 51, 51);">速度</span></font></div><div><font style="font-size: 14pt;">6、<span style="min-height: 15pt; color: rgb(51, 51, 51);">查询中统计或者分组字段</span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 15pt; color: rgb(51, 51, 51);"><br/></span></font></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);"><span style="line-height: 27px;">哪些情况不需要创建索引</span></font></div><div><font color="#333333"><span style="font-size: 19px; line-height: 27px;">1、表记录太少</span></font></div><div><font color="#333333"><span style="font-size: 19px; line-height: 27px;">2、经常增删改的表或字段</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font color="#333333"><span style="font-size: 14pt; min-height: 17pt; color: rgb(51, 51, 51);">Why:</span><font style="font-size: 14pt;"><span style="min-height: 17pt; color: rgb(51, 51, 51);">提高了查询速度，同时却会降低更新表的速度，如对表进行</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">INSERT</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">、</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">UPDATE</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">和</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">DELETE</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">。</span></font></font></div><div><font color="#333333"><font style="font-size: 14pt;"><span style="min-height: 17pt; color: rgb(51, 51, 51);">因为更新表时，</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">MySQL</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">不仅要保存数据，还要保存一下索引文件</span></font></font></div></div><div><font color="#333333"><span style="font-size: 19px; line-height: 27px;">3、where条件里用不到的字段不创建索引</span></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div></span>
</div>
<hr>
<a name="2557"/>

<div>
<span><div><font><font style="font-size: 18pt; color: rgb(186, 0, 255);">性能分析是什么</font><br/></font></div><div><font style="font-size: 14pt;">      查看执行计划</font><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 12pt;">使用</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">EXPLAIN</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 12pt;">关键字可以模拟优化器执行</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">SQL</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 12pt;">查询语句，从而知道</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">MySQL</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 12pt;">是</span></div><div><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 12pt;">如何处理你的</span><span style="min-height: 17pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 12pt;">SQL</span><span style="min-height: 17pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 12pt;">语句的。分析你的查询语句或是表结构的性能瓶颈</span></div></div><div><font style="font-size: 14pt;">          官网介绍</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 26pt; color: rgb(51, 51, 51);"><a href="http://dev.mysql.com/doc/refman/5.5/en/explain-output.html">http://dev.mysql.com/doc/refman/5.5/en/explain-output.html</a></span></div><div><img src="05_mysql_02_索引优化分析_files/Image [7].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="1330"/></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">性能分析能干什么</font></span></div><div><span style="font-size: 19px; line-height: 27px;">     1、表的读取顺序</span></div><div><span style="font-size: 19px; line-height: 27px;">     2、哪些索引可以使用</span></div><div><span style="font-size: 19px; line-height: 27px;">     3、数据读取操作的操作类型</span></div><div><span style="font-size: 19px; line-height: 27px;">     4、哪些索引被实际使用</span></div><div><span style="font-size: 19px; line-height: 27px;">     5、表之间的引用</span></div><div><span style="font-size: 19px; line-height: 27px;">     6、每张表有多少行被物理查询</span></div><div><span style="font-size: 19px; line-height: 27px;"><br/></span></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">性能分析怎么玩</font></span></div><div><span style="font-size: 19px; line-height: 27px;">      1、explain+SQL语句</span></div><div><span style="font-size: 19px; line-height: 27px;">      2、执行计划包含的信息</span></div><div><img src="05_mysql_02_索引优化分析_files/Image [8].png" type="image/png" data-filename="" style="font-size: 14pt;"/></div><div><span style="font-size: 19px; line-height: 27px;">      3、建表脚本</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> CREATE TABLE t1(id INT(10) AUTO_INCREMENT,content  VARCHAR(100) NULL ,  PRIMARY KEY (id));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> CREATE TABLE t2(id INT(10) AUTO_INCREMENT,content  VARCHAR(100) NULL ,  PRIMARY KEY (id));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> CREATE TABLE t3(id INT(10) AUTO_INCREMENT,content  VARCHAR(100) NULL ,  PRIMARY KEY (id));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> CREATE TABLE t4(id INT(10) AUTO_INCREMENT,content  VARCHAR(100) NULL ,  PRIMARY KEY (id));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> INSERT INTO t1(content) VALUES(CONCAT('t1_',FLOOR(1+RAND()*1000)));</span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  INSERT INTO t2(content) VALUES(CONCAT('t2_',FLOOR(1+RAND()*1000)));</span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  INSERT INTO t3(content) VALUES(CONCAT('t3_',FLOOR(1+RAND()*1000)));</span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  INSERT INTO t4(content) VALUES(CONCAT('t4_',FLOOR(1+RAND()*1000)));</span></div></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div><div><font style="font-size: 14pt;"><br/></font></div></span>
</div>
<hr>
<a name="2563"/>

<div>
<span><div><span><font style="font-size: 14pt;"><img src="05_mysql_02_索引优化分析_files/Image [9].png" type="image/png" data-filename="Image.png" style="font-size: 14pt;"/></font></span></div><div><span><br/></span></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">id</font></span></div><div><span style="line-height: 27px;"><span style="font-size: 19px;"> </span> <font style="font-size: 14pt;">  <span style="min-height: 13pt; color: rgb(51, 51, 51);">select</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">查询的序列号</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">,</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">包含一组数字，表示查询中执行</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">select</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">子句或操作表的顺序</span></font></span></div><div><span style="font-size: 19px; line-height: 27px;">    三种情况：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><img src="05_mysql_02_索引优化分析_files/Image [10].png" type="image/png" data-filename="" style="text-indent: 0mm; font-size: 9pt; line-height: 1.45; font-family: Monaco;" width="733"/></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 18pt; color: rgb(51, 51, 51);">id相同，执行顺序由上至下</span></div></div><div><span style="font-size: 19px; line-height: 27px;">   </span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 124pt;"><img src="05_mysql_02_索引优化分析_files/Image [11].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="924"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; font-family: Tahoma; font-size: 14pt;">id</span><span style="text-indent: 0mm; font-family: 宋体; font-size: 14pt;">不同，如果是子查询，</span><span style="text-indent: 0mm; font-family: Tahoma; font-size: 14pt;">id</span><span style="text-indent: 0mm; font-family: 宋体; font-size: 14pt;">的序号会递增，</span><span style="text-indent: 0mm; font-family: Tahoma; font-size: 14pt;">id</span><span style="text-indent: 0mm; font-family: 宋体; font-size: 14pt;">值越大优先级越高，越先被执行</span></div></div><div><span style="font-size: 19px; line-height: 27px;"> </span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"> <span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">id</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">相同不同，同时存在</span></font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><img src="05_mysql_02_索引优化分析_files/Image [12].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="772"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">id如果相同，可以认为是一组，从上往下顺序执行；</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">在所有组中，id值越大，优先级越高，越先执行</span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;"> </span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">衍生 = DERIVED</span></div></div><div><br/></div><div><span style="font-size: 19px; line-height: 27px;">    关注点：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-family: 微软雅黑; font-size: 14pt;"><span style="min-height: 13pt; color: rgb(255, 0, 0);">id</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">号每个号码，表示一趟独立的查询。一个</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">sql</span> <span style="min-height: 13pt; color: rgb(255, 0, 0);">的查询趟数越少越好。</span></font></div></div><div><br/></div><div><br/></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">select_type</font></span></div><div><span style="font-size: 19px; line-height: 27px;">     有哪些</span></div><div><img src="05_mysql_02_索引优化分析_files/Image [13].png" type="image/png" data-filename="" style="font-size: 14pt;"/></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">     查询的类型，主要是用于区别</font></span><span style="font-size: 14pt; color: rgb(51, 51, 51); line-height: 1.45;">普通查询、联合查询、子查询等的复杂查询</span></div><div><span style="font-size: 19px; line-height: 27px;"> </span></div><div><br/></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">table</font></span></div><div><span style="line-height: 27px;"><font style="font-size: 14pt;">     <span style="min-height: 12pt; color: rgb(51, 51, 51);">显示这一行的数据是关于哪张表的</span></font></span></div><div><br/></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">type</font></span></div><div><img src="05_mysql_02_索引优化分析_files/Image [14].png" type="image/png" data-filename="" style="font-size: 18pt; color: rgb(186, 0, 255);"/></div><div>访问类型排列</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 13pt;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">type显示的是访问类型，是较为重要的一个指标，结果</span><span style="font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 16pt;">值从最好到最坏依次是</span><span style="font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">：</span></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"></div></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: Tahoma; font-size: 16pt; line-height: 1.45; text-indent: 0mm;">system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; line-height: 1.45; text-indent: 0mm;">一般来说，得保证查询至少达到range级别，最好能达到ref。</span></div></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">显示查询使用了何种类型，</font></span></div><div style="min-height: 12pt;"><span style="min-height: 12pt; color: rgb(255, 0, 0); font-weight: bold;"><font style="font-size: 14pt;">从最好到最差依次是：</font></span><span style="font-size: 14pt; color: rgb(51, 51, 51); line-height: 1.45;">system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</span></div><div style="min-height: 12pt;"><span style="font-size: 14pt; color: rgb(51, 51, 51); line-height: 1.45;">   system </span></div><div style="min-height: 12pt;"><span style="color: rgb(51, 51, 51); line-height: 1.45;"><span style="font-size: 14pt;">       </span> <font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">表只有一行记录（等于系统表），这是</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">const</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">类型的特列，平时不会出现，这个也可以忽略不计</span></font></span></div><div style="min-height: 12pt;"><span style="color: rgb(51, 51, 51); line-height: 1.45;"><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">   const</span></font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font face="宋体" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">    表示通过索引一次就找到了</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">,const</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">用于比较</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">primary key</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">或者</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">unique</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">索引。因为只匹配一行数据，所以很快</span></font></div><div><font face="宋体" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">如将主键置于</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">where</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">列表中，</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">MySQL</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">就能将该查询转换为一个常量</span></font></div><div><img src="05_mysql_02_索引优化分析_files/Image [15].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="min-height: 12pt;"><span style="color: rgb(51, 51, 51); line-height: 1.45;"><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">    eq_ref</span></font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-family: 微软雅黑; font-size: 12pt;">唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配。常见于主键或唯一索引扫描</font></span></div><div><img src="05_mysql_02_索引优化分析_files/Image [16].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="min-height: 12pt;"><span style="color: rgb(51, 51, 51); line-height: 1.45;"><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">    ref</span></font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">非唯一性索引扫描，返回匹配某个单独值的所有行</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">.</span><span style="line-height: 1.45;">本质上也是一种索引访问，它返回所有匹配某个单独值的行，然而，</span></font><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45;">它可能会找到多个符合条件的行，所以他应该属于查找和扫描的混合体</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 89pt;"><img src="05_mysql_02_索引优化分析_files/Image [17].png" type="image/png" data-filename="" style="font-size: 12pt; color: rgb(51, 51, 51);" width="823"/></div><div><img src="05_mysql_02_索引优化分析_files/Image [18].png" type="image/png" data-filename="" style="font-size: 12pt; color: rgb(51, 51, 51);" width="901"/></div></div><div style="min-height: 12pt;"><span style="line-height: 1.45;"><font style="font-size: 14pt;"><span style="color: rgb(51, 51, 51); min-height: 13pt;"> </span> <span style="min-height: 13pt;"><font style="color: rgb(251, 205, 95);">range</font></span></font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">只检索给定范围的行</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">,</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">使用一个索引来选择行。</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">key</span> <span style="min-height: 13pt; color: rgb(51, 51, 51);">列显示使用了哪个索引</span></font><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">一般就是在你的</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">where</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">语句中出现了</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">between</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">、</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">&lt;</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">、</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">&gt;</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">、</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">in</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">等的查询</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45;">这种范围扫描索引扫描比全表扫描要好，因为它只需要开始于索引的某一点，而结束语另一点，不用扫描全部索引。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 67pt;"><img src="05_mysql_02_索引优化分析_files/Image [19].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);" width="715"/></div><div><img src="05_mysql_02_索引优化分析_files/Image [20].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);" width="713"/></div></div><div style="min-height: 12pt;"><div><font color="#333333">  index</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-family: 微软雅黑; font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">      出现</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">index</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">是</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">sql</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">使用了索引但是</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">没用通过索引进行过滤</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">，一般是使用了</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">覆盖索引</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">或者是</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">利用索引进行了排序分组</span></font></div><div><br/></div><div><img src="05_mysql_02_索引优化分析_files/Image [21].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="min-height: 12pt;"><div>  <font style="color: rgb(255, 0, 0);">all</font></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-family: 微软雅黑; font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">Full Table Scan</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">，将遍历全表以找到匹配的行</span></font></div><div><img src="05_mysql_02_索引优化分析_files/Image [22].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="min-height: 12pt;">index_merge</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-family: 微软雅黑; font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">在查询过程中需要多个索引组合使用，通常出现在有</span> <span style="min-height: 13pt; color: rgb(51, 51, 51);">or</span> <span style="min-height: 13pt; color: rgb(51, 51, 51);">的关键字的</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">sql</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">中</span></font></div><div><img src="05_mysql_02_索引优化分析_files/Image [23].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="min-height: 12pt;">ref_or_null</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-family: 微软雅黑; font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">对于某个字段既需要关联条件，也需要</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">null</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">值得情况下。查询优化器会选择用</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">ref_or_null</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">连接查询。</span></font></div><div><img src="05_mysql_02_索引优化分析_files/Image [24].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="min-height: 12pt;"><div>index_subquery</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-family: 微软雅黑; font-size: 12pt;">利用索引来关联子查询，不再全表扫描。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 107pt;"><img src="05_mysql_02_索引优化分析_files/Image [25].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);" width="754"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 34pt;"><img src="05_mysql_02_索引优化分析_files/Image [26].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);" width="339"/></div><div><img src="05_mysql_02_索引优化分析_files/Image [27].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);" width="929"/></div></div><div style="min-height: 12pt;"><div>unique_subquery</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-family: 微软雅黑; font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">该联接类型类似于</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">index_subquery</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">。</span> <span style="min-height: 13pt; color: rgb(51, 51, 51);">子查询中的唯一索引</span></font></div><div><img src="05_mysql_02_索引优化分析_files/Image [28].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div style="min-height: 12pt;"><br/></div><div style="min-height: 12pt;"><div><span style="color: rgb(51, 51, 51); line-height: 1.45;"><font><span style="min-height: 13pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(255, 0, 0);">备注：一般来说，得保证查询至少达到</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">range</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">级别，最好能达到</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">ref</span><span style="min-height: 13pt; color: rgb(255, 0, 0);">。</span></font></span></font></span></div></div><div><br/></div><div><span style="line-height: 27px;"><font style="color: rgb(186, 0, 255); font-size: 18pt;">possible_keys</font></span></div><div><span style="line-height: 27px;"><span style="font-size: 19px;">      </span><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">显示可能应用在这张表中的索引，一个或多个。</font></span></span></div><div><font style="font-size: 14pt;"><span style="min-height: 12pt; color: rgb(51, 51, 51);">查询涉及到的字段上若存在索引，则该索引将被列出，</span><span style="min-height: 12pt; color: rgb(255, 0, 0); font-weight: bold;">但不一定被查询实际使用</span></font></div><div><br/></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">key</font></span></div><div><span style="line-height: 27px;"><span style="font-size: 19px;">   </span><font style="font-size: 14pt;"> <span style="min-height: 13pt; color: rgb(51, 51, 51);">实际使用的索引。如果为</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">NULL</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">，则没有使用索引</span></font></span></div><div><span style="line-height: 27px;"><font style="font-size: 14pt;">    <span style="min-height: 13pt; color: rgb(0, 0, 255);">查询中若使用了覆盖索引，则该索引和查询的</span><span style="min-height: 13pt; color: rgb(0, 0, 255);">select</span><span style="min-height: 13pt; color: rgb(0, 0, 255);">字段重叠</span></font></span></div><div><img src="05_mysql_02_索引优化分析_files/Image [29].png" type="image/png" data-filename="" style="font-size: 14pt;" width="772"/></div><div><br/></div><div><br/></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">key_len</font></span></div><div><span style="line-height: 27px;"><font style="font-size: 14pt;">    <span style="min-height: 12pt; color: rgb(51, 51, 51);">表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度。</span></font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="line-height: 27px;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.age=30 AND emp.name LIKE 'ab%';</span></font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 164pt;"><span style="line-height: 27px;"><img src="05_mysql_02_索引优化分析_files/Image [30].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="783"/></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="line-height: 27px;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">如何计算</span></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">1 、先看索引上字段的类型+长度比如 int=4 ; </span> <span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">varchar(</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 10pt;">20</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">) =</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 10pt;">20 ;</span> <span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">char(</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 10pt;">20</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">)</span> <span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">=</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 10pt;">20 </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">2  、如果是varchar或者char这种字符串字段，视字符集要乘不同的值，比如utf-8  要乘 3,GBK要乘2，</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">3 、varchar这种动态字符串要加2个字节</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">4、 允许为空的字段要加1个字节 </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 120pt;"><span style="text-indent: 0mm; min-height: 120pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><img src="05_mysql_02_索引优化分析_files/Image [31].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="478"/><span style="text-indent: 0mm; min-height: 120pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  、</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> 第一组</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">key_len=age的字节长度+name的字节长度=4+1  + ( 20*3+2)=5+62=67</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> 第二组</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> key_len=age的字节长度=4+1=5</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><img src="05_mysql_02_索引优化分析_files/Image [32].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="647"/></div></div><div><span style="line-height: 27px;"><font style="font-size: 14pt;">    <span style="min-height: 13pt; color: rgb(51, 51, 51);">key_len</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">字段能够帮你检查是否充分的利用上了索引</span></font></span></div><div><br/></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">ref</font></span></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">   显示索引的哪一列被使用了，如果可能的话，是一个常数。哪些列或常量被用于查找索引列上的值</font></span></div><div><img src="05_mysql_02_索引优化分析_files/Image [33].png" type="image/png" data-filename="" style="font-size: 14pt;"/></div><div><br/></div><div><span style="line-height: 27px;"><font style="color: rgb(186, 0, 255); font-size: 18pt;">rows</font></span></div><div><span style="line-height: 27px;"><font style="font-size: 14pt;">   <span style="min-height: 13pt; color: rgb(51, 51, 51);">rows</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">列显示</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">MySQL</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">认为它执行查询时必须检查的行数。</span></font></span></div><div><span style="line-height: 27px;"><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">越少越好</span></font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">·</span> <img src="05_mysql_02_索引优化分析_files/Image [34].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="703"/></div><div><img src="05_mysql_02_索引优化分析_files/Image [35].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="932"/></div></div><div><br/></div><div><span style="line-height: 27px;"><font style="font-size: 18pt; color: rgb(186, 0, 255);">Extra</font></span></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">     包含不适合在其他列中显示但十分重要的额外信息</font></span></div><div><br/></div><div><font style="color: rgb(255, 0, 0);">1、Using filesort</font></div><div><font style="font-size: 14pt;">            <span style="min-height: 13pt; color: rgb(51, 51, 51);">说明</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">mysql</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">会对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取。</span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">      MySQL</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">中无法利用索引完成的排序操作称为“文件排序”</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> 出现filesort的情况：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 302pt;"><img src="05_mysql_02_索引优化分析_files/Image [36].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="878"/><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;">优化后，不再出现filesort的情况：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 308pt;"><img src="05_mysql_02_索引优化分析_files/Image [37].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="898"/><span style="color: rgb(0, 0, 255); font-family: 宋体; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度</span></div></div><div><br/></div><div><br/></div><div><font style="color: rgb(255, 0, 0);">2、Using temporary</font></div><div>         <font style="font-size: 14pt;"> <span style="min-height: 13pt; color: rgb(51, 51, 51);">使了用临时表保存中间结果</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">,MySQL</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">在对查询结果排序时使用临时表。常见于排序</span> <span style="min-height: 13pt; color: rgb(51, 51, 51);">order    by</span> <span style="min-height: 13pt; color: rgb(51, 51, 51);">和分组查询</span> <span style="min-height: 13pt; color: rgb(51, 51, 51);">group by</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">。</span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">优化前存在 using  temporary 和 using  filesort </span> <img src="05_mysql_02_索引优化分析_files/Image [38].png" type="image/png" data-filename="" style="text-indent: 0mm; font-size: 9pt; line-height: 1.45; font-family: Monaco;" width="982"/></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><div><font style="font-size: 14pt;"><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;">优化前存在 using  temporary 和 using  filesort 不在，性能发生明显变化：</span></font></div></div><div><font style="font-size: 14pt;"><img src="05_mysql_02_索引优化分析_files/Image [39].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="977"/></font></div></div><div>3、Using index</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 12pt;">表示相应的select操作中使用了覆盖索引(Covering Index)，避免访问了表的数据行，效率不错！</font></span></div><div style="min-height: 13pt;"><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">如果同时出现</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">using where</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">，表明索引被用来执行索引键值的查找</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">;</span></font></div><div><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">如果没有同时出现</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">using where</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">，表明索引只是用来读取数据而非利用索引执行查找。</span></font></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 12pt;">利用索引进行了排序或分组</font></span></div></div><div>4、Using where</div><div>    <font style="font-size: 14pt;">  <span style="min-height: 13pt; color: rgb(51, 51, 51);">表明使用了</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">where</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">过滤</span></font></div><div><font style="color: rgb(255, 0, 0);">5、Using join buffer</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-family: 微软雅黑; font-size: 12pt;">使用了连接缓存：</font></span></div><div><img src="05_mysql_02_索引优化分析_files/Image [40].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div><span style="line-height: 1.45;">6、impossible where</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-family: 微软雅黑; font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">where</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">子句的值总是</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">false</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">，不能用来获取任何元组</span></font></div><div><img src="05_mysql_02_索引优化分析_files/Image [41].png" type="image/png" data-filename="" style="font-family: 宋体; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div>7、select tables optimized away</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">在没有</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">GROUPBY</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">子句的情况下，基于索引优化</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">MIN/MAX</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">操作或者</span></font></div><div style="min-height: 13pt;"><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">对于</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">MyISAM</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">存储引擎优化</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">COUNT(*)</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">操作，不必等到执行阶段再进行计算，</span></font></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 12pt;">查询执行计划生成的阶段即完成优化。</font></span></div><div><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">在innodb中：</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 72pt;"><img src="05_mysql_02_索引优化分析_files/Image [42].png" type="image/png" data-filename="" style="font-size: 12pt; color: rgb(51, 51, 51);" width="657"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">在Myisam中：</font></span></div><div><img src="05_mysql_02_索引优化分析_files/Image [43].png" type="image/png" data-filename="" style="font-size: 12pt; color: rgb(51, 51, 51);" width="829"/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="2637"/>

<div>
<span><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">往表里插入50W数据</font></div><div>1、建表<br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);"> </span><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">CREATE TABLE `dept` (</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> `id` INT(11) NOT NULL AUTO_INCREMENT,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> `deptName` VARCHAR(30) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> `address` VARCHAR(40) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> ceo INT NULL ,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> PRIMARY KEY (`id`)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"><br/></font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">CREATE TABLE `emp` (</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> `id` INT(11) NOT NULL AUTO_INCREMENT,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> `empno` INT NOT NULL ,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> `name` VARCHAR(20) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> `age` INT(3) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> `deptId` INT(11) DEFAULT NULL,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> PRIMARY KEY (`id`)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> #CONSTRAINT `fk_dept_id` FOREIGN KEY (`deptId`) REFERENCES `t_dept` (`id`)</font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</font></span></div></div><div><span style="line-height: 1.45;">2、设置参数log_bin_trust_function_creators</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">创建函数，假如报错：This function has none of DETERMINISTIC......</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">#</span> <span style="text-indent: 0mm; font-family: Arial; font-size: 16pt; color: rgb(51, 51, 51);">由于开启过慢查询日志，</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">因为我们开启了 bin-log, 我们就必须为我们的function指定一个参数。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; color: rgb(0, 0, 255); font-family: 'Lucida Grande'; font-size: 16pt; line-height: 1.45;">show variables like 'log_bin_trust_function_creators';</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(0, 0, 255); font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">set global log_bin_trust_function_creators=1;</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;"># 这样添加了参数以后，如果mysqld重启，上述参数又会消失，永久方法：</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">windows下my.ini[mysqld]加上log_bin_trust_function_creators=1</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">linux下    /etc/my.cnf下my.cnf[mysqld]加上log_bin_trust_function_creators=1</span></div></div><div><span style="line-height: 1.45;">3、创建函数，保证每条数据都不同</span><br/></div><div><span style="line-height: 1.45;">     随机产生字符串</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="font-family: 'Lucida Grande'; line-height: 1.45; text-indent: 0mm;"><font style="font-size: 14pt;">DELIMITER $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">CREATE FUNCTION rand_string(n INT) RETURNS VARCHAR(255)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">BEGIN </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> DECLARE chars_str VARCHAR(100) DEFAULT 'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ';</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> DECLARE return_str VARCHAR(255) DEFAULT '';</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> DECLARE i INT DEFAULT 0;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> WHILE i &lt; n DO </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> SET return_str =CONCAT(return_str,SUBSTRING(chars_str,FLOOR(1+RAND()*52),1));</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> SET i = i + 1;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> END WHILE;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> RETURN return_str;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">END $$</font></span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span><span style="font-family: 'Lucida Grande'; line-height: 1.45; text-indent: 0mm;">#假如要删除</span></font></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">#drop function rand_string;</font></span></div></div><div><span style="line-height: 1.45;">    随机产生部门编号</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span><span style="font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;">#用于随机产生多少到多少的编号</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">DELIMITER $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">CREATE FUNCTION  rand_num (from_num INT ,to_num INT) RETURNS INT(11)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">BEGIN  </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> DECLARE i INT DEFAULT 0; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> SET i = FLOOR(from_num +RAND()*(to_num -from_num+1))   ;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">RETURN i; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> END$$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande';">#</span><span style="text-indent: 0mm; min-height: 8pt; font-family: Arial;">假如要删除</span></font></div><div><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">#drop function</span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">rand_num</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">;</span></font></div></div><div><span style="line-height: 1.45;">4、创建存储过程</span><br/></div><div>创建往emp表中插入数据的存储过程<br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="font-family: 'Lucida Grande'; line-height: 1.45; text-indent: 0mm;"><font style="font-size: 14pt;">DELIMITER $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">CREATE PROCEDURE  insert_emp(  START INT ,  max_num INT )</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">BEGIN </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">DECLARE i INT DEFAULT 0;  </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">#set autocommit =0 把autocommit设置成0 </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> SET autocommit = 0;   </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> REPEAT </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> SET i = i + 1; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> INSERT INTO emp (empno, NAME ,age ,deptid ) VALUES ((START+i) ,rand_string(6)   , rand_num(30,50),rand_num(1,10000)); </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> UNTIL i = max_num </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> END REPEAT; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> COMMIT; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"> END$$</span> </font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span><span style="font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;">#删除</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"># DELIMITER ;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"># drop PROCEDURE insert_emp;</font></span></div></div><div><span style="line-height: 1.45;">创建往dept表中插入数据的存储过程</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span><span style="font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;">#执行存储过程，往dept表添加随机数据</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">DELIMITER $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">CREATE PROCEDURE `insert_dept`(  max_num INT )</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">BEGIN </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">DECLARE i INT DEFAULT 0;  </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> SET autocommit = 0;   </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> REPEAT </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> SET i = i + 1; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> INSERT INTO dept ( deptname,address,ceo ) VALUES (rand_string(8),rand_string(10),rand_num(1,500000)); </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> UNTIL i = max_num </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> END REPEAT; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> COMMIT; </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"> END$$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande';">#</span><span style="text-indent: 0mm; min-height: 8pt; font-family: Arial;">删除</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"># DELIMITER ;</font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;"># drop PROCEDURE insert_dept;</font></span></div></div><div><span style="line-height: 1.45;">5、调用存储过程</span><br/></div><div>dept<br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; text-indent: 0mm; line-height: 1.45;">#执行存储过程，往dept表添加1万条数据</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">DELIMITER ;</font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">CALL insert_dept(10000);</font></span></div></div><div><span style="line-height: 1.45;">emp</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; line-height: 1.45; text-indent: 0mm;"><font style="font-size: 14pt;">#执行存储过程，往emp表添加50万条数据</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">DELIMITER ;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">CALL insert_emp(100000,500000);</font></span></div></div><div><br/></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">批量删除某个表上的所有索引</font></div><div>    存储过程<br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">DELIMITER $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">CREATE  PROCEDURE `proc_drop_index`(dbname VARCHAR(200),tablename VARCHAR(200))</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">BEGIN</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">       DECLARE done INT DEFAULT 0;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">       DECLARE ct INT DEFAULT 0;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">       DECLARE _index VARCHAR(200) DEFAULT '';</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">       DECLARE _cur CURSOR FOR  SELECT   index_name   FROM information_schema.STATISTICS   WHERE table_schema=dbname AND table_name=tablename AND seq_in_index=1 AND    index_name &lt;&gt;'PRIMARY'  ;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">       DECLARE  CONTINUE HANDLER FOR NOT FOUND set done=2 ;     </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">        OPEN _cur;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">        FETCH   _cur INTO _index;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">        WHILE  _index&lt;&gt;'' DO</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">               SET @str = CONCAT(&quot;drop index &quot;,_index,&quot; on &quot;,tablename );</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">               PREPARE sql_str FROM @str ;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">               EXECUTE  sql_str;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">               DEALLOCATE PREPARE sql_str;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">               SET _index='';</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">               FETCH   _cur INTO _index;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">        END WHILE;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">   CLOSE _cur;</font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">   END$$</font></span></div></div><div><span style="line-height: 1.45;">  执行存储过程</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">CALL proc_drop_index(&quot;dbname&quot;,&quot;tablename&quot;);</font></span></div></div><div><br/></div></span>
</div>
<hr>
<a name="2639"/>

<div>
<span><div>案例（索引失效）</div><div> 1、全值匹配我最爱<br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> 系统中经常出现的sql语句如下： </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.age=30 </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.age=30 and deptid=4</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.age=30 and deptid=4 AND emp.name = 'abcd' </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;">索引应该如何建立 ？</span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">CREATE INDEX idx_age_deptid_name ON emp(age,deptid,NAME)</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;">建立索引前</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 26pt;"><img src="05_mysql_02_索引优化分析_files/Image [44].png" type="image/png" data-filename="" style="font-family: Lucida Grande; font-size: 10pt; color: rgb(1, 1, 1);" width="693"/></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;">索引后</span></div><div><img src="05_mysql_02_索引优化分析_files/Image [45].png" type="image/png" data-filename="" style="font-family: Lucida Grande; font-size: 10pt; color: rgb(1, 1, 1);" width="666"/></div></div><div><span style="line-height: 1.45;"> 2、最佳左前缀法则</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">如果系统经常出现的sql如下：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">  SELECT SQL_NO_CACHE * FROM emp WHERE emp.age=30   AND emp.name = 'abcd'  </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">或者</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">SELECT SQL_NO_CACHE * FROM emp WHERE emp.deptid=1   AND emp.name = 'abcd'  </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> 那原来的idx_age_deptid_name 还能否正常使用？</span></div></div><div><font style="font-size: 14pt;"><span style="min-height: 12pt; color: rgb(51, 51, 51);">       如果索引了多列，要遵守最左前缀法则。指的是查询从索引的最左前列开始并且</span><span style="min-height: 12pt; color: rgb(255, 0, 0); font-weight: bold;">不跳过索引中的列。</span></font><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;"> EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE emp.age=30   AND emp.name = 'abcd'  </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 66pt;"><img src="05_mysql_02_索引优化分析_files/Image [46].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="865"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">虽然可以正常使用，但是只有部分被使用到了。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 81pt;"><img src="05_mysql_02_索引优化分析_files/Image [47].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="703"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">完全没有使用上索引。</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">结论：过滤条件要使用索引必须按照索引建立时的顺序，依次满足，一旦跳过某个字段，索引后面的字段都无法被使用。</span></div></div><div><span style="line-height: 1.45; font-size: 14pt;"> 3、</span><span style="line-height: 1.45; font-size: 14pt; min-height: 17pt; color: rgb(51, 51, 51);">不在索引列上做任何操作（计算、函数、</span><span style="line-height: 1.45; font-size: 14pt; min-height: 17pt; color: rgb(51, 51, 51);">(</span><span style="line-height: 1.45; font-size: 14pt; min-height: 17pt; color: rgb(51, 51, 51);">自动</span><span style="line-height: 1.45; font-size: 14pt; min-height: 17pt; color: rgb(51, 51, 51);">or</span><span style="line-height: 1.45; font-size: 14pt; min-height: 17pt; color: rgb(51, 51, 51);">手动</span><span style="line-height: 1.45; font-size: 14pt; min-height: 17pt; color: rgb(51, 51, 51);">)</span><span style="line-height: 1.45; font-size: 14pt; min-height: 17pt; color: rgb(51, 51, 51);">类型转换），会导致索引失效而转向全表扫描</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">这两条sql哪种写法更好</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">SELECT SQL_NO_CACHE * FROM emp WHERE   emp.name  LIKE 'abc%'</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> SELECT SQL_NO_CACHE * FROM emp WHERE   LEFT(emp.name,3)  = 'abc'</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45; text-indent: 0mm;">第一种</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 358pt;"><img src="05_mysql_02_索引优化分析_files/Image [48].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="727"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> 第二种</span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);"> </span><img src="05_mysql_02_索引优化分析_files/Image [49].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="717"/></div></div><div><span style="font-size: 14pt; line-height: 1.45;"> 4、</span><span style="font-size: 14pt; line-height: 1.45; min-height: 15pt; color: rgb(51, 51, 51);">存储引擎不能使用索引中范围条件右边的列</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> 如果系统经常出现的sql如下：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> SELECT  SQL_NO_CACHE * FROM emp WHERE emp.age=30 AND emp.deptId&gt;20 AND emp.name = 'abc' ;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">那么索引 idx_age_deptid_name这个索引还能正常使用么？</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><img src="05_mysql_02_索引优化分析_files/Image [50].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="850"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 8pt;"><span style="text-indent: 0mm; min-height: 8pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">如果这种sql 出现较多</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">应该建立：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">create index idx_age_name_deptid on emp(age,name,deptid)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">效果</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 72pt;"><img src="05_mysql_02_索引优化分析_files/Image [51].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="978"/></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"># drop index idx_age_name_deptid on emp</span></div></div><div><span style="font-size: 14pt; line-height: 1.45;"> 5、</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">mysql</span> <span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">在使用不等于</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">(!=</span> <span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">或者</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">&lt;&gt;)</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">的时候无法使用索引会导致全表扫描</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  CREATE INDEX idx_name ON emp(NAME)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  EXPLAIN SELECT SQL_NO_CACHE * FROM emp WHERE   emp.name &lt;&gt;  'abc'</span></div><div><img src="05_mysql_02_索引优化分析_files/Image [52].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="723"/></div></div><div><span style="font-size: 14pt; line-height: 1.45;"> 6、</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">is not null</span> <span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">也无法使用索引</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">,</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">但是</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">is null</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">是可以使用索引的</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;">UPDATE emp SET age =NULL WHERE id=123456;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  </span> <span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">下列哪个sql语句可以用到索引</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  EXPLAIN SELECT * FROM emp WHERE age IS NULL</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  EXPLAIN SELECT * FROM emp WHERE age IS NOT NULL</span></div><div><img src="05_mysql_02_索引优化分析_files/Image [53].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="997"/></div></div><div><span style="font-size: 14pt; line-height: 1.45;"> 7、</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">like</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">以通配符开头</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">('%abc...')mysql</span><span style="font-size: 14pt; line-height: 1.45; min-height: 17pt; color: rgb(51, 51, 51);">索引失效会变成全表扫描的操作</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div><img src="05_mysql_02_索引优化分析_files/Image [54].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="783"/></div></div><div><font style="line-height: 1.45; font-size: 14pt;"> 8、<span style="min-height: 15pt; color: rgb(51, 51, 51);">字符串不加单引号索引失效</span></font><span style="line-height: 1.45;"> </span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><img src="05_mysql_02_索引优化分析_files/Image [55].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="737"/></div></div><div><span style="font-size: 14pt; line-height: 1.45;"> 9、</span><span style="font-size: 14pt; line-height: 1.45; min-height: 12pt; color: rgb(51, 51, 51);">小总结</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);"> 假设index(a,b,c)</span></font></div><table style="table-layout: fixed; border-collapse: collapse; border-width: 1px; border-color: #000000;"><colgroup><col style="width: 182px;"></col><col style="width: 184px;"></col></colgroup><tbody><tr><td align="center" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold;">Where语句</span></div></td><td align="center" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold;">索引是否被使用</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3  </span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">Y,使用到a</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3 and b = 5</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">Y,使用到a，b</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3 and b = 5 and c = 4</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">Y,使用到a,b,c</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where b = 3 或者 where b = 3 and c = 4 </span> <span style="text-indent: 0mm; min-height: 11pt; font-family: Arial; font-size: 14pt;">或者</span> <span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where c = 4</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">N</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3 and c = 5</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">使用到a， 但是c不可以，b中间断了</span></div></td></tr><tr><td align="left" height="92" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3 and b &gt; 4 and c = 5</span></div></td><td align="left" height="92" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">使用到a和b， c不能用在范围之后，b断了</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a is null and b is not null </span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">  is null 支持索引 但是is not null 不支持,所以 a 可以使用索引,但是  b不可以使用</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a &lt;&gt; 3  </span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;"> 不能使用索引</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">where   abs(a) =3</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">不能使用 索引</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3 and b like 'kk%' and c = 4</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">Y,使用到a,b,c</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3 and b like '%kk' and c = 4</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">Y,只用到a</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3 and b like '%kk%' and c = 4</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">Y,只用到a</span></div></td></tr><tr><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="171"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 11pt;"><span style="text-indent: 0mm; min-height: 11pt; font-family: 'Lucida Grande'; font-size: 14pt;">where a = 3 and b like 'k%kk%' and c = 4</span></div></td><td align="left" style="border: 1px solid rgb(0, 0, 0);" valign="top" width="173"><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 0.99mm; margin-bottom: 1.99mm; min-height: 17pt;"><span style="text-indent: 0mm; min-height: 17pt; font-family: 'Lucida Grande'; font-size: 14pt;">Y,使用到a,b,c</span></div></td></tr></tbody></table><div><font style="font-size: 14pt;"><br/></font></div></div><div><font style="font-size: 14pt;"><span style="min-height: 12pt; color: rgb(51, 51, 51);"><br/></span></font></div><div><font color="#333333">一般性建议</font></div><div><font color="#333333" style="font-size: 14pt;"> 1、 <span style="min-height: 17pt; color: rgb(51, 51, 51);">对于单键索引，尽量选择针对当前</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">query</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">过滤性更好的索引</span></font></div><div><font color="#333333" style="font-size: 14pt;"><span style="min-height: 17pt; color: rgb(51, 51, 51);"> 2、 <span style="min-height: 17pt; color: rgb(51, 51, 51);">在选择组合索引的时候，当前</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">Query</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">中过滤性最好的字段在索引字段顺序中，位置越靠前越好。</span></span></font></div><div><font color="#333333" style="font-size: 14pt;"><span style="min-height: 17pt; color: rgb(51, 51, 51);"><span style="min-height: 17pt; color: rgb(51, 51, 51);"> 3、<span style="min-height: 17pt; color: rgb(51, 51, 51);">在选择组合索引的时候，尽量选择可以能够包含当前</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">query</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">中的</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">where</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">字句中更多字段的索引</span></span></span></font></div><div><font color="#333333" style="font-size: 14pt;"><span style="min-height: 17pt; color: rgb(51, 51, 51);"><span style="min-height: 17pt; color: rgb(51, 51, 51);"> 4、<span style="min-height: 15pt; color: rgb(51, 51, 51);">在选择组合索引的时候，如果某个字段可能出现范围查询时，尽量把这个字段放在索引次序的最后面</span></span></span></font></div><div><font style="color: rgb(51, 51, 51); font-size: 14pt;"><span style="min-height: 17pt; color: rgb(51, 51, 51);"><span style="min-height: 17pt; color: rgb(51, 51, 51);"> 5、<span style="min-height: 17pt; color: rgb(51, 51, 51);">书写</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">sql</span><span style="min-height: 17pt; color: rgb(51, 51, 51);">语句时，尽量避免造成索引失效的情况</span></span></span></font></div></span>
</div>
<hr>
<a name="2641"/>

<div>
<span><div><span><font style="font-size: 18pt; color: rgb(186, 0, 255);">关联查询优化</font></span></div><div><span>  一、建表SQL</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 12pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;">CREATE TABLE IF NOT EXISTS `class` (</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">`id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">`card` INT(10) UNSIGNED NOT NULL,</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">PRIMARY KEY (`id`)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">CREATE TABLE IF NOT EXISTS `book` (</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">`bookid` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">`card` INT(10) UNSIGNED NOT NULL,</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">PRIMARY KEY (`bookid`)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">);</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO class(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">INSERT INTO book(card) VALUES(FLOOR(1 + (RAND() * 20)));</span></div></div><div>  二、案例</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt;">#</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt;">下面开始</span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt;">explain</span><span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt;">分析</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">EXPLAIN SELECT * FROM class LEFT JOIN book ON class.card = book.card;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">#</span><span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">结论：</span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">type</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">有</span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">All</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt;">#</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt;">添加索引优化</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">ALTER TABLE `book` ADD INDEX Y ( `card`);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">#</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">第</span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">2</span><span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">次</span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">explain</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">EXPLAIN SELECT * FROM class LEFT JOIN book ON class.card = book.card;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">#</span><span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">可以看到第二行的</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">type</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">变为了</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">ref,rows</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">也变成了优化比较明显。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">#</span><span style="text-indent: 0mm; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">这是由左连接特性决定的。</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">LEFT JOIN</span> <span style="text-indent: 0mm; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">条件用于确定如何从右表搜索行</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">,</span><span style="text-indent: 0mm; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">左边一定都有</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">,</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">#</span><span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">所以右边是我们的关键点</span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">,</span><span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">一定需要建立索引。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">#</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">删除旧索引</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">+</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">新建</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">+</span> <span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">第</span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">3</span><span style="text-indent: 0mm; min-height: 6pt; font-family: Arial; font-size: 14pt; color: rgb(51, 51, 51);">次</span><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">explain</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">DROP INDEX Y ON book;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">ALTER TABLE class ADD INDEX X (card);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">EXPLAIN SELECT * FROM class LEFT JOIN book ON class.card = book.card;</span></div></div><div>  三、建议 </div><div>    1、保证被驱动表的join字段已经被索引</div><div>    2、left join时，选择小表作为驱动表，大表作为被驱动表</div><div>    3、inner join 时，mysql会自己帮你把小结果集的表选为驱动表</div><div>    4、子查询尽量不要放在被驱动表，有可能使用不到索引</div><div><br/></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">子查询优化</font></div><div>      尽量不要使用not in 或者 not exists</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">取所有不为掌门人的员工，按年龄分组</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  SELECT SQL_NO_CACHE * FROM emp a WHERE  id  NOT  IN(SELECT ceo FROM dept b2 WHERE ceo IS NOT NULL)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  group by age</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  having count(*)&lt;10000</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 109pt;"><img src="05_mysql_02_索引优化分析_files/Image [56].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="933"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 93pt;"><img src="05_mysql_02_索引优化分析_files/Image [57].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="1040"/></div><div><img src="05_mysql_02_索引优化分析_files/Image [58].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="309"/></div></div><div><span style="line-height: 1.45;">      用left outer join on xxx is null 替代</span><span style="line-height: 1.45;">   </span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;"> EXPLAIN SELECT SQL_NO_CACHE a.* FROM  emp a LEFT OUTER JOIN dept b ON a.id =b.ceo</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  WHERE    b.ceo IS   NULL</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  group by age</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">  having count(*)&lt;10000</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 125pt;"><img src="05_mysql_02_索引优化分析_files/Image [59].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="898"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 195pt;"><img src="05_mysql_02_索引优化分析_files/Image [60].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="587"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 141pt;"><img src="05_mysql_02_索引优化分析_files/Image [61].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="314"/></div></div><div> <br/></div><div><br/></div></span>
</div>
<hr>
<a name="2643"/>

<div>
<span><div><span>order by 关键字优化</span></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">尽可能在索引列上完成排序操作，遵照索引建的最佳左前缀</font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><img src="05_mysql_02_索引优化分析_files/Image [62].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="656"/></div></div><div>case</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> create index idx_age_deptid_name on emp (age,deptid,name)</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt;">以下</span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span> <span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt;">是否能使用到索引，能否去掉</span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">using filesort</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45; text-indent: 0mm;">1、explain  select * from emp order by age,deptid;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45; text-indent: 0mm;">2、 explain  select * from emp order by age,deptid limit 10;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">#无过滤 必排序</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">3、  explain  select * from emp where age=45 order by deptid;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45; text-indent: 0mm;">4、explain  select * from emp where age=45 order by   deptid,name;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">5、explain  select * from emp where age=45 order by  deptid,empno;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">6、explain  select * from emp where age=45 order by  name,deptid;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">7、 explain select * from emp where deptid=45 order by age;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(255, 0, 0); font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">#顺序错，必排序</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt;"> </span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45;">8、explain  select * from emp where age=45 order by age,deptid;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">9、explain  select * from emp where age=45 order by  deptid,age</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">#值确定，不排序</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> 10、  explain select * from emp where age=45 order by  deptid desc, name desc ;</span><span style="font-family: 'Lucida Grande'; font-size: 12pt; line-height: 1.45; text-indent: 0mm;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">  11、 explain select * from emp where age=45 order by  deptid asc, name desc ;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span> <span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">#方向反 必排序</span></div></div><div><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">ORDER BY</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">子句，尽量使用</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">Index</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">方式排序</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">,</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">避免使用</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">FileSort</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">方式排序</span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);"><br/></span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">如果不在索引列上，</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">filesort</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">有两种算法：</span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">mysql</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">就要启动双路排序和单路排序</span></font></div><div><span style="line-height: 1.45;">1、双路排序</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">      MySQL 4.1</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">之前是使用双路排序</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">,</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">字面意思就是两次扫描磁盘，最终得到数据，</span></font><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">读取行指针和</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">orderby</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">列，对他们进行排序，然后扫描已经排序好的列表，按照列表中的值重新从列表中读取对应的数据输出</span></div><div><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">      从磁盘取排序字段，在</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">buffer</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">进行排序，再从磁盘取其他字段。</span></font><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">取一批数据，要对磁盘进行了两次扫描，众所周知，</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">I\O</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">是很耗时的，所以在</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">mysql4.1</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">之后，出现了第二种改进的算法，就是单路排序。</span></div></div><div><span>2、单路排序</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font face="微软雅黑" style="font-size: 12pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">      从磁盘读取查询需要的所有列，按照</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">order by</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">列在</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">buffer</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">对它们进行排序，然后扫描排序后的列表进行输出，</span></font><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">它的效率更快一些，避免了第二次读取数据。并且把随机</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">IO</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">变成了顺序</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">IO,</span><span style="font-size: 12pt; font-family: 微软雅黑; line-height: 1.45; min-height: 13pt;">但是它会使用更多的空间，</span></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 12pt;">因为它把每一行都保存在内存中了。</font></span></div></div><div><span> 3、结论及引申出的问题</span><span style="line-height: 1.45;"> </span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 14pt;">由于单路是后出的，总体而言好过双路</font></span></div><div><span style="min-height: 12pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 14pt;">但是用单路有问题</font></span></div><div><font face="微软雅黑" style="font-size: 14pt;"><span style="text-indent: 0mm; min-height: 9pt; color: rgb(1, 1, 1);"> </span><span style="line-height: 1.45; text-indent: 0mm;">在sort_buffer中，方法B比方法A要多占用很多空间，因为方法B是把所有字段都取出, 所以有可能取出的数据的总大小超出了sort_buffer的容量，导致每次只能取sort_buffer容量大小的数据，进行排序（创建tmp文件，多路合并），排完再取取sort_buffer容量大小，再排……从而多次I/O。</span></font></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; color: rgb(1, 1, 1);"><font face="微软雅黑" style="font-size: 14pt;"> </font></span><span style="font-size: 14pt; font-family: 微软雅黑; text-indent: 0mm; line-height: 1.45;">本来想省一次I/O操作，反而导致了大量的I/O操作，反而得不偿失。</span></div></div><div>4、优化策略</div><div><span style="line-height: 1.45;">增大sort_buffer_size参数的设置</span><br/></div><div>增大max_length_for_sort_data参数的设置</div><div>减少select后面的查询的字段</div><div>why<br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">提高Order By的速度</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">1. Order by时select * 是一个大忌只Query需要的字段， 这点非常重要。在这里的影响是：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">      1.1 当Query的字段大小总和小于max_length_for_sort_data 而且排序字段不是 TEXT|BLOB 类型时，会用改进后的算法——单路排序， 否则用老算法——多路排序。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">     1.2 两种算法的数据都有可能超出sort_buffer的容量，超出之后，会创建tmp文件进行合并排序，导致多次I/O，但是用单路排序算法的风险会更大一些,所以要提高sort_buffer_size。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">2. 尝试提高 sort_buffer_size</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">不管用哪种算法，提高这个参数都会提高效率，当然，要根据系统的能力去提高，因为这个参数是针对每个进程的 </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; font-weight: bold; color: rgb(51, 51, 51);">1M-8M之间调整</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 16pt; text-indent: 0mm; line-height: 1.45;">3. 尝试提高 max_length_for_sort_data</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 16pt; color: rgb(51, 51, 51);">提高这个参数， 会增加用改进算法的概率。但是如果设的太高，数据总容量超出sort_buffer_size的概率就增大，明显症状是高的磁盘I/O活动和低的处理器使用率. </span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">                </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold; color: rgb(51, 51, 51);">1024-8192之间调整</span></div></div><div><br/></div><div><br/></div><div>group by关键字优化</div><div>1、group by 实质是先排序后进行分组，遵照索引建的最佳左前缀</div><div>2、当无法使用索引列，增大max_length_for_sort_data参数的设置+增大sort_buffer_size参数的设置</div><div>3、where高于having，能写在where限定的条件就不要去having限定了</div><div>4、group by使用索引的原则几乎跟order by一致，唯一区别是group by即使没有过滤条件用到索引，也可以直接使用索引。</div><div><br/></div></span>
</div>
<hr>
<a name="2645"/>

<div>
<span><div><font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">1、执行案例前先清除</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">emp</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">上的索引，只留主键</span></font></div><div>2、索引的选择</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">#查询 年龄为30岁的，且员工编号小于101000的用户，按用户名称排序</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; line-height: 1.45; text-indent: 0mm;">SELECT SQL_NO_CACHE * FROM emp WHERE age =30 AND empno &lt;101000 ORDER BY NAME ;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 72pt;"><img src="05_mysql_02_索引优化分析_files/Image [63].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="839"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 84pt;"><img src="05_mysql_02_索引优化分析_files/Image [64].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="605"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 71pt;"><span style="text-indent: 0mm; min-height: 71pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><img src="05_mysql_02_索引优化分析_files/Image [65].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="314"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">#结论：很显然,type 是 ALL,即最坏的情况。Extra 里还出现了 Using filesort,也是最坏的情况。优化是必须的。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold; text-indent: 0mm; line-height: 1.45;">#开始优化：</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold; color: rgb(51, 51, 51);">思路：  尽量让where的过滤条件和排序使用上索引</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold; color: rgb(51, 51, 51);">但是一共两个字段(deptno,empno)上有过滤条件，一个字段(ename)有索引</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold; color: rgb(51, 51, 51);">1、我们建一个三个字段的组合索引可否？</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 118pt;"><img src="05_mysql_02_索引优化分析_files/Image [66].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="952"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">CREATE INDEX idx_age_empno_name ON emp(age,empno,NAME);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">我们发现using filesort 依然存在，所以name 并没有用到索引。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">原因是因为empno是一个范围过滤，所以索引后面的字段不会再使用索引了。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;">所以我们建一个3值索引是没有意义的</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">那么我们先删掉这个索引，DROP INDEX idx_age_empno_name ON emp</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 14pt; text-indent: 0mm; line-height: 1.45;">为了去掉filesort我们可以把索引建成</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">CREATE INDEX idx_age_name ON emp(age,NAME);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 120pt;"><img src="05_mysql_02_索引优化分析_files/Image [67].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="759"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">也就是说empno 和name这个两个字段我只能二选其一。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);"> 这样我们优化掉了 using filesort。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> 执行一下sql</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 105pt;"><img src="05_mysql_02_索引优化分析_files/Image [68].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="621"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 74pt;"><img src="05_mysql_02_索引优化分析_files/Image [69].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="310"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">速度果然提高了4倍。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);"> </span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;"> .......</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">但是</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">如果我们选择那个范围过滤，而放弃排序上的索引呢</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">建立</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">DROP INDEX idx_age_name ON emp</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">create index idx_age_eno on emp(age,empno);</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 30pt;"><img src="05_mysql_02_索引优化分析_files/Image [70].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="408"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 80pt;"><img src="05_mysql_02_索引优化分析_files/Image [71].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="940"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> 果然出现了filesort，而且type还是range光看字面其实并不美好。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">我们来执行以下sql</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 105pt;"><img src="05_mysql_02_索引优化分析_files/Image [72].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="621"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 72pt;"><span style="text-indent: 0mm; min-height: 72pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><img src="05_mysql_02_索引优化分析_files/Image [73].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="338"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">结果竟然有 filesort的 sql 运行速度，超过了已经优化掉 filesort的 sql ，而且快了好多倍。何故？</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">原因是所有的排序都是在条件过滤之后才执行的，所以如果条件过滤了大部分数据的话，几百几千条数据进行排序其实并不是很消耗性能，即使索引优化了排序但实际提升性能很有限。  相对的 empno&lt;101000 这个条件如果没有用到索引的话，要对几万条的数据进行扫描，这是非常消耗性能的，所以索引放在这个字段上性价比最高，是最优选择。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold;">结论</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt;">：</span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold;">当范围条件和group by 或者 order by  的字段出现二选一时 ，</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 14pt; font-weight: bold;">优先观察条件字段的过滤数量</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; font-weight: bold;">，如果过滤的数据足够多，而需要排序的数据并不多时，优先把索引放在范围字段上。反之，亦然。</span></div></div><div><br/></div><div>3、覆盖索引</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 14pt; text-indent: 0mm; line-height: 1.45;">什么是覆盖索引？</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 6pt;"><span style="text-indent: 0mm; min-height: 6pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">简单说就是，select 到 from 之间查询的列 &lt;=使用的索引列+主键</span><span style="color: rgb(1, 1, 1); font-family: 'Lucida Grande'; font-size: 10pt; text-indent: 0mm; line-height: 1.45;"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 166pt;"><img src="05_mysql_02_索引优化分析_files/Image [74].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="949"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;">explain select * from emp where name like '%abc';</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 81pt;"><img src="05_mysql_02_索引优化分析_files/Image [75].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="709"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 405pt;"><img src="05_mysql_02_索引优化分析_files/Image [76].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="460"/></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span><span style="font-family: 'Lucida Grande'; font-size: 12pt; text-indent: 0mm; line-height: 1.45;">使用覆盖索引后</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 408pt;"><img src="05_mysql_02_索引优化分析_files/Image [77].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="548"/></div></div><div><br/></div></span>
</div></body></html> 