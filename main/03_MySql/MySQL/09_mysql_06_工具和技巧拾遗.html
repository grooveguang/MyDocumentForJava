<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/10.0.10240 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="2807"/>

<div>
<span><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">视图 view是什么</font></div><div>      将一段查询sql封装为一个虚拟的表</div><div>      这个虚拟表只保存了sql逻辑，不会保存任何查询结果。</div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">视图作用</font></div><div>1、封装复杂sql语句，提高复用性</div><div>2、逻辑放在数据库上面，更新不需要发布程序，面对频繁的需求变更更灵活</div><div><br/></div><div><font style="color: rgb(186, 0, 255); font-size: 18pt;">适用场景</font></div><div>       很多地方可以共用的一组查询结果</div><div>        报表</div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">语法</font></div><div>     创建</div><div>     作用<br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 5pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="text-indent: 0mm; min-height: 5pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 14pt;">CREATE VIEW view_name</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 14pt;">AS</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 14pt;">SELECT column_name(s)</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 14pt;">FROM table_name</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 5pt;"><span style="text-indent: 0mm; min-height: 5pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 14pt;">WHERE condition</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font face="微软雅黑" style="font-size: 14pt;"><span style="text-indent: 0mm; color: rgb(51, 51, 51);"> </span><span style="line-height: 1.45; text-indent: 0mm;">使用：</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; color: rgb(51, 51, 51);"><font face="微软雅黑" style="font-size: 14pt;">select * from view_name</font></span></div></div><div><br/></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">注意事项</font></div><div>     mysql的视图中不允许有from后面的子查询，但Oracle可以</div></span>
</div>
<hr>
<a name="2809"/>

<div>
<span><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">定义</font></div><div>     根据某张表发生的事件比如：insert,update,delete,来触发执行某些处理</div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">适用场景</font></div><div>      冗余数据的同步</div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">语法</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">DELIMITER $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(0, 0, 255);">CREATE   TRIGGER  </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">tr_afterupdate_t_dept</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(0, 0, 255);">AFTER UPDATE ON</span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">t_dept</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(0, 0, 255);"><font style="font-size: 14pt;">FOR EACH ROW</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">   </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(0, 0, 255);">BEGIN</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);"><font style="font-size: 14pt;">    UPDATE  t_emp a</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);"><font style="font-size: 14pt;">    LEFT JOIN  t_dept b ON a.`deptId` = b.`id`</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);"><font style="font-size: 14pt;">    LEFT JOIN  t_emp c ON b.`CEO` = c.`id`</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);"><font style="font-size: 14pt;">    SET a.`ceo_name`=c.name</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);"><font style="font-size: 14pt;">    WHERE b.id=new.id;  #new 或old 指向当前正在更新的行</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(0, 0, 255);">  END</span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">$$</span></font></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">DELIMITER ;</font></span></div></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">注意事项</font></div><div>1、trigger触发器虽然方便但是非常不利于维护</div><div>2、影响数据库性能</div><div>3、这种非程序触发的写操作很难被日志追踪</div><div>4、触发了某事件的表，不能利用触发器对自己做操作</div></span>
</div>
<hr>
<a name="2811"/>

<div>
<span><div><span><font style="font-size: 18pt; color: rgb(186, 0, 255);">作用</font></span></div><div><span>    用来做定时任务</span></div><div><span><br/></span></div><div><span><font style="font-size: 18pt; color: rgb(186, 0, 255);">语法</font></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);"><font style="font-size: 14pt;">CREATE </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    [DEFINER = { user | CURRENT_USER }] </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">   </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">EVENT </span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    [IF NOT EXISTS] </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">   </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">event_name </span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">   </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">ON SCHEDULE</span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 102, 255);">schedule </span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    [ON COMPLETION [NOT] PRESERVE] </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    [ENABLE | DISABLE | DISABLE ON SLAVE] </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    [COMMENT 'comment'] </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">   </span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">DO event_body;</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"> </span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"> </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 102, 255);"><font style="font-size: 14pt;">schedule: </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    AT timestamp [+ INTERVAL interval] ... </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">  |</span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">EVERY</span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 102, 255);">interval </span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 14pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">    [</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">STARTS</span> <span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">timestamp [+ INTERVAL interval] ...] </span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    [ENDS timestamp [+ INTERVAL interval] ...] </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"> </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 102, 255);"><font style="font-size: 14pt;">interval: </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    quantity {YEAR | QUARTER | MONTH | DAY | HOUR | MINUTE | </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">              WEEK | SECOND | YEAR_MONTH | DAY_HOUR | DAY_MINUTE | </font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">              DAY_SECOND | HOUR_MINUTE | HOUR_SECOND | MINUTE_SECOND} </font></span></div></div><div><br/></div><div>     开启定时事件的开关</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">SHOW  VARIABLES  LIKE '%event_scheduler%';</font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">SET GLOBAL event_scheduler =1;</font></span></div></div><div><br/></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">Demo</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);"><font style="font-size: 14pt;">#创建实体表</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">CREATE TABLE mv_top_second ( deptid INT ,NAME  VARCHAR(200),age INT);</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">SELECT * FROM mv_top_second</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"> </font></span><span style="color: rgb(255, 0, 0); font-family: 'Lucida Grande'; font-size: 14pt; line-height: 1.45; text-indent: 0mm;">#创建更新实体表的存储过程</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">delimiter $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">create  procedure  proc_mv_top_second()</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">begin</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">  truncate table mv_top_second;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">  SET @rank=0;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">  SET @last_deptid=0;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">  INSERT INTO  mv_top_second</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    SELECT a.deptid,a.name,a.age</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">  FROM (</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">  SELECT</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">   t.*,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">   IF (@last_deptid=deptid,@rank:=@rank+1,@rank:=1) AS  rk,</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">    @last_deptid:=deptid AS last_deptid</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">   FROM t_emp  t</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">   ORDER BY deptid ,age  DESC</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">   ) a WHERE a.rk=2;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">end $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;"> </font></span><span style="color: rgb(255, 0, 0); font-family: 'Lucida Grande'; font-size: 14pt; line-height: 1.45; text-indent: 0mm;">#创建定时任务</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">DELIMITER $$</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">CREATE EVENT ev_onemin_job</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">ON SCHEDULE EVERY 1 MINUTE STARTS NOW()  # 从现在开始  每分钟执行1次</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">ON COMPLETION PRESERVE ENABLE   # COMPLETION [NOT] PRESERVE  结束的时候 是否还保存该事件  ENABLE/DISABLE 结束后是否还启用该事件 </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">DO</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">BEGIN</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">   call  proc_mv_top_second();</font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 14pt;">end$$</font></span></div></div><div><br/></div><div><br/></div></span>
</div>
<hr>
<a name="2813"/>

<div>
<span><div><span><font style="font-size: 18pt; color: rgb(186, 0, 255);">需求</font></span></div><div><span>       <font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">每日凌晨</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">2</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">点备份</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">mydb</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">数据库脚本。并以年月为目录，以年月日为文件名，放到</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">/backup/mysql</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">下</span></font></span></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">备份</font></div><div>     导出语句</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">mysqldump命令</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">导出 sql文件</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">格式：  mysqldump -u[用户名] -p[密码] [要导出的数据库]&gt;[导出的文件.sql]</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">例如：</font></span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">mysqldump -uroot -p123123 mydb&gt;/backup/mysql/mydb_2017050X.sql</font></span></div></div><div><br/></div><div>     shell脚本</div><div>Linux Shell中的反引号，单引号，双引号</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">反引号</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">位 (`) 位于键盘的Tab键的上方、1键的左方。注意与单引号(')位于Enter键的左方的区别。</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">　　</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">在shell脚本中被反引号括起来的字符串会被shell识别为</span><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">可执行且有返回值的命令。</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　如下，shell会执行反引号中的date命令，把结果插入到echo命令显示的内容中。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　[root@localhost sh]# echo The date is `date`</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　The date is 2011年 03月 14日 星期一 21:15:43 CST</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　单引号、双引号用于用户把带有空格的字符串赋值给变量事的分界符。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　[root@localhost sh]# str=&quot;Today is Monday&quot;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　[root@localhost sh]# echo $str</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　Today is Monday</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　如果没有单引号或双引号，shell会把空格后的字符串解释为命令。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　[root@localhost sh]# str=Today is Monday</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　bash: is: command not found</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　单引号和双引号的区别。单引号告诉shell忽略所有特殊字符，而双引号忽略大多数，但不包括$、\、`。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　[root@localhost sh]# testvalue=100</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　[root@localhost sh]# echo 'The testvalue is $testvalue'</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　The testvalue is $testvalue</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　[root@localhost sh]# echo &quot;The testvalue is $testvalue&quot;</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">　　The testvalue is 100</font></span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;"> </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 10pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 10pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);">在shell脚本中被反引号括起来的字符串会被shell识别为</span><span style="text-indent: 0mm; min-height: 10pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0);">可执行且有返回值的命令</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">所以`date +%Y%m%d` 代表它执行后的结果，即 20170101</font></span></div></div><div>if then else fi</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">linux的判断语句</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">if</span> <span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">[</span> <span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">#判断语句</span> <span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">]</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 1pt;"><span style="text-indent: 0mm; min-height: 1pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">then </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> #执行的内容</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 1pt;"><span style="text-indent: 0mm; min-height: 1pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">else</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">   #执行的内容</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 1pt;"><span style="text-indent: 0mm; min-height: 1pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">fi</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">或者</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">if  test</span><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">  #判断语句</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 1pt;"><span style="text-indent: 0mm; min-height: 1pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">then</span><span style="text-indent: 0mm; min-height: 1pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> #执行的内容</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 1pt;"><span style="text-indent: 0mm; min-height: 1pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">else</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">   #执行的内容</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 1pt;"><span style="text-indent: 0mm; min-height: 1pt; font-family: 'Lucida Grande'; font-size: 12pt; font-weight: bold; color: rgb(51, 51, 51);">fi</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 2pt;"><span style="text-indent: 0mm; min-height: 2pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">其中判断语句</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);"> </span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ -a FILE ] 如果 FILE 存在则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">[ -d FILE ] 如果 FILE 存在且是一个目录则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ -e FILE ] 如果 FILE 存在则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">[ -f FILE ] 如果 FILE 存在且是一个普通文件则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ FILE1 -nt FILE2 ] 如果 FILE1 has been changed more recently than FILE2, or 如果 FILE1 exists and FILE2 does not则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ FILE1 -ot FILE2 ] 如果 FILE1 比 FILE2 要老, 或者 FILE2 存在且 FILE1 不存在则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ FILE1 -ef FILE2 ] 如果 FILE1 和 FILE2 指向相同的设备和节点号则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ -o OPTIONNAME ] 如果 shell选项 “OPTIONNAME” 开启则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">[ -z STRING ] “STRING” 的长度为零则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">[</span> <span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">-n STRING ] or [ STRING ] “STRING” 的长度为非零 non-zero则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ STRING1 == STRING2 ] 如果2个字符串相同。 “=” may be used instead of “==” for strict POSIX compliance则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ STRING1 != STRING2 ] 如果字符串不相等则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ STRING1 &lt; STRING2 ] 如果 “STRING1” sorts before “STRING2” lexicographically in the current locale则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 12pt; color: rgb(51, 51, 51);">[ STRING1 &gt; STRING2 ] 如果 “STRING1” sorts after “STRING2” lexicographically in the current locale则为真。</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">Linux的编程中常用字符串代替符号，比如用 eq 代替  ==</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">eq -- equal ==</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">ne -- not eq !=</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">gt -- great &gt;</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">ge -- g&amp;e &gt;=</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">lt -- little &lt;</span></div><div><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(255, 0, 0); font-size: 12pt;">le -- l&amp;e &lt;=</span></div></div><div>保存脚本文件 backup.sh</div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">定时任务</font></div><div>    crond和crontab</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">crond是linux定时任务服务。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><font style="font-size: 12pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">通过</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; font-weight: bold; color: rgb(51, 51, 51);">service crond start/stop</span><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);">来控制服务的启动关闭。</span></font></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">crond是每分钟检查一次事件是否触发。所以linux定时任务最小的执行频率是1分钟。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">crontab 是设定、管理定时任务的命令行工具。</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">通过crontab -e 来定制定时任务</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">基本格式 :</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">30　　2　　1　　12　　*　　command</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">分　时　日　月　周　命令</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">第1列表示分钟1～59 每分钟用*或者 */1表示</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">第2列表示小时1～23（0表示0点）</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">第3列表示日期1～31</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">第4列表示月份1～12</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">第5列标识号星期0～6（0表示星期天）</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">第6列要运行的命令</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">crontab文件的一些例子：</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;">30 21 * * *  service mysql restart </font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1);"><font style="font-size: 12pt;"> 上面的含义是 每天21点30分执行重启mysql</font></span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 0pt;"><span style="text-indent: 0mm; min-height: 0pt; font-family: 'Lucida Grande'; font-weight: bold; color: rgb(51, 51, 51);"><font style="font-size: 12pt;">定时执行脚本就是   0 2 * * * sh /backup/mysql/backup.sh</font></span></div></div><div><br/></div></span>
</div></body></html> 