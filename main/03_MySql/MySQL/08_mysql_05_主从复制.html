<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/10.0.10240 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="2821"/>

<div>
<span><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">复制的基本原理</font></div><div>   slave会从master读取binlog来进行数据同步</div><div>   三步骤+原理图</div><div><img src="08_mysql_05_主从复制_files/Image.png" type="image/png" data-filename=""/></div><div>    1、master将改变记录到二进制日志（binary log），这些记录过程叫做二进制日志事件，binary log events</div><div>    2、slave将master的binary log events拷贝到它的中继日志（relay log）</div><div>    3、slave重做中继日志的事件，将改变应用到自己的数据库中，MySQL复制是异步的且穿行化的。</div><div><br/></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">复制的基本原则</font></div><div>   1、每个slave只有一个master</div><div>   2、每个slave只能有一个唯一的服务器ID</div><div>   3、每个master可以有多个salve</div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">复制的最大问题</font></div><div>     延迟</div></span>
</div>
<hr>
<a name="2825"/>

<div>
<span><div><span><font style="font-size: 18pt; color: rgb(186, 0, 255);">mysql版本一致且后台以服务运行</font></span></div><div><span><br/></span></div><div><span><font style="font-size: 18pt; color: rgb(186, 0, 255);">主从都配置在[mysqld]结点下，都是小写</font></span></div><div><span><br/></span></div><div><span><font style="color: rgb(186, 0, 255); font-size: 18pt;">主机修改my.ini配置文件</font></span></div><div><span>1、【必须】主服务器唯一ID<br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span><font style="font-size: 14pt;">server-id=1</font></span></div></div><div><span><span style="line-height: 1.45;">2、【必须】启用二进制日志</span><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">log-bin=</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">自己本地的路径</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">/data/mysqlbin</span></font></div><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">log-bin=D:/devSoft/MySQLServer5.5/data/mysqlbin</font></span></div></div><div><span style="line-height: 1.45;">3、【可选】启用错误日志</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">log-err=</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">自己本地的路径/data</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">/mysqlerr</span></font></div><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">log-err=D:/devSoft/MySQLServer5.5/data/mysqlerr</font></span></div></div><div><span style="line-height: 1.45;">4、【可选】根目录</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">basedir=&quot;</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">自己本地路径</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">&quot;</span></font></div><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">basedir=&quot;D:/devSoft/MySQLServer5.5/&quot;</font></span></div></div><div><span style="line-height: 1.45;">5、【可选】临时目录</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">tmpdir=&quot;</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">自己本地路径</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">&quot;</span></font></div><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">tmpdir=&quot;D:/devSoft/MySQLServer5.5/&quot;</font></span></div></div><div><span style="line-height: 1.45;">6、【可选】数据目录</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">datadir=&quot;</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">自己本地路径</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">/Data/&quot;</span></font></div><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">datadir=&quot;D:/devSoft/MySQLServer5.5/Data/&quot;</font></span></div></div><div><span style="line-height: 1.45;">7、read-only=0</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 12pt; font-family: 宋体; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">主机，读写都可以</font></span></div></div><div><span style="line-height: 1.45;">8、【可选】设置不需要复制的数据库</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">binlog-ignore-db=mysql</font></span></div></div><div><span style="line-height: 1.45;">9、【可选】设置需要复制的数据库</span><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">binlog-do-db=</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">需要复制的主数据库名字</span></font></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 12pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div><img src="08_mysql_05_主从复制_files/Image [1].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="1202"/></div></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">从机配置文件修改my.ini的[mysql]栏位下</font><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">server-id</font></span></div><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51);"><font style="font-size: 14pt;">relay-log=mysql-relay</font></span></div></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">因修改过配置文件，请主机+从机都重启后台mysql服务</font></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">主机从机都关闭防火墙</font><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">windows</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">手动关闭</span></font></div><div><font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">关闭虚拟机</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">linux</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">防火墙</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">    service iptables stop</span></font></div></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">在Windows主机上建立账户并授权slave</font></div><div>1、<font style="font-size: 14pt;"><span style="min-height: 13pt; color: rgb(51, 51, 51);">GRANT REPLICATION SLAVE ON *.* TO 'zhangsan'@'</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">从机器数据库</span><span style="min-height: 13pt; color: rgb(51, 51, 51);">IP' IDENTIFIED BY '123456';</span></font></div><div><img src="08_mysql_05_主从复制_files/Image [2].png" type="image/png" data-filename=""/></div><div>2、show privileges;</div><div>3、查询master的状态</div><div>     show master status；</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><img src="08_mysql_05_主从复制_files/Image [3].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div>     记录下file和position的值</div><div>4、执行完步骤后不要再操作主服务器MySQL，防止主服务器状态值变化</div><div><br/></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">在Linux从机上配置需要复制的主机</font></div><div>1、<font style="font-size: 14pt;"><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">MASTER_HOST='主</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">机</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">IP',MASTER_USER='zhangsan',MASTER_PASSWORD='123456',MASTER_LOG_FILE='File</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">名字</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">',MASTER_LOG_POS=Position</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51);">数字</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51);">;</span></font><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span><span style="font-family: 'Lucida Grande'; font-size: 14pt; line-height: 1.45; text-indent: 0mm;">CHANGE MASTER TO MASTER_HOST='192.168.124.3',</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">MASTER_USER='zhangsan',</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm; min-height: 3pt;"><span style="text-indent: 0mm; min-height: 3pt; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">MASTER_PASSWORD='123456',</span></div><div style="margin-left: 0mm; margin-right: 0mm; text-indent: 0mm; margin-top: 4.75mm; margin-bottom: 4.75mm;"><span style="text-indent: 0mm; font-family: 'Lucida Grande'; font-size: 14pt; color: rgb(51, 51, 51);">MASTER_LOG_FILE='mysqlbin.具体数字',MASTER_LOG_POS=具体值;</span></div><div style="margin: 0.99mm 0mm 1.99mm; text-indent: 0mm; min-height: 9pt;"><span style="text-indent: 0mm; min-height: 9pt; font-family: 'Lucida Grande'; color: rgb(1, 1, 1); font-size: 10pt;"> </span></div><div><img src="08_mysql_05_主从复制_files/Image [4].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);" width="963"/></div></div><div>2、启动从服务器复制功能</div><div>    start slave</div><div>3、show slave status\G</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><img src="08_mysql_05_主从复制_files/Image [5].png" type="image/png" data-filename="" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br/></div><div><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 9pt;">下面两个参数都是</span><span style="min-height: 13pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 9pt;">Yes</span><span style="min-height: 13pt; font-family: 宋体; color: rgb(51, 51, 51); font-size: 9pt;">，则说明主从配置成功！</span></div><div> <span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 9pt;">Slave_IO_Running: Yes</span></div><div><span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 9pt;">  <span style="min-height: 10pt; font-family: Tahoma; color: rgb(51, 51, 51); font-size: 9pt;">Slave_SQL_Running: Yes</span></span></div></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">主机新建库、新建表、insert记录，从机复制</font></div><div><br/></div><div><font style="font-size: 18pt; color: rgb(186, 0, 255);">如何停止从服务复制功能</font></div><div>       stop slave；</div><div><br/></div><div><br/><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 